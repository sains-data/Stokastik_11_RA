---
title: "Tubes Pemstok"
author: "Dea Mutia Risani"
date: "2025-11-17"
output: html_document
---

## Persiapan

```{r}
# install.packages("tidyverse")
# install.packages("markovchain")

library(tidyverse)
library(markovchain)

# Definisikan nama file Anda
nama_file <- "C:/Users/userl/Downloads/Data_Pemstok.xlsx"
```

## Membaca dan Membersihkan Data

```{r}
# --- 1. Membaca dan Membersihkan Data Awal ---
data_raw <- read_excel(nama_file)

# Rename kolom skenario agar mudah diakses:
# Kolom 4: Transisi dari Instagram (A)
# Kolom 5: Transisi dari WhatsApp (B)
# Kolom 6: Transisi dari Website Kampus (C)
data_clean <- data_raw %>%
  rename(
    Trans_dari_A = 4,
    Trans_dari_B = 5,
    Trans_dari_C = 6
  ) %>%
  # Pilih hanya kolom transisi dan jadikan faktor untuk konsistensi:
  select(Trans_dari_A, Trans_dari_B, Trans_dari_C) %>%
  mutate_all(as.factor)

# Lihat struktur data hasil pembersihan
print(head(data_clean))
```

## Penghitungan Matriks Frekuensi (Count Matrix)

```{r}
# --- 2. Penghitungan Matriks Frekuensi (Count Matrix) ---

# Definisikan Status (Pastikan sesuai dengan jawaban di data Anda)
STATUS <- c("Instagram", "WhatsApp", "Website Kampus")

# Inisialisasi Matriks Frekuensi 3x3
count_matrix <- matrix(0, nrow = 3, ncol = 3, dimnames = list(STATUS, STATUS))

# --- BARIS 1: Transisi dari Status A (Instagram) ---
# Tally jawaban dari kolom Trans_dari_A (Start A) ke Status Next (A, B, atau C)
counts_A <- table(data_clean$Trans_dari_A)
count_matrix["Instagram", names(counts_A)] <- counts_A

# --- BARIS 2: Transisi dari Status B (WhatsApp) ---
# Tally jawaban dari kolom Trans_dari_B (Start B) ke Status Next (A, B, atau C)
counts_B <- table(data_clean$Trans_dari_B)
count_matrix["WhatsApp", names(counts_B)] <- counts_B

# --- BARIS 3: Transisi dari Status C (Website Kampus) ---
# Tally jawaban dari kolom Trans_dari_C (Start C) ke Status Next (A, B, atau C)
counts_C <- table(data_clean$Trans_dari_C)
count_matrix["Website Kampus", names(counts_C)] <- counts_C

# Hasil Matriks Frekuensi
cat("\nMatriks Frekuensi (Count Matrix):\n")
print(count_matrix)
```

## Pembentukan Matriks Probabilitas Transisi

```{r}
# --- 3. Pembentukan Matriks Probabilitas Transisi (P) ---

# Matriks probabilitas dihitung dengan menormalisasi setiap baris
# (membagi setiap baris dengan totalnya)

# Pastikan semua kolom Matriks Frekuensi memiliki status yang benar sebelum dibagi:
# Karena Anda hanya memiliki 3 Status, kita bisa pastikan urutannya.
# Urutan: 1=Instagram, 2=WhatsApp, 3=Website Kampus

# Mengkonversi Matriks Frekuensi menjadi Matriks Probabilitas Transisi
# (Fungsi markovchain memerlukan data dalam bentuk transisi, tapi kita bisa pakai cara manual dulu
# atau langsung dari matrix jika semua status tercakup)

# Cara Manual (Lebih Transparan untuk Tugas Besar):
prob_matrix <- count_matrix
for (i in 1:nrow(prob_matrix)) {
  total_row <- sum(prob_matrix[i, ])
  prob_matrix[i, ] <- prob_matrix[i, ] / total_row
}

# Hasil Matriks Probabilitas Transisi (P)
cat("\nMatriks Probabilitas Transisi (P):\n")
print(prob_matrix)
```

## Analisis Jangka Panjang

```{r}
# --- 1. Load Library ---
# Pastikan library sudah terinstal: install.packages("markovchain")
library(markovchain)

# --- 2. Definisikan States dan Matriks P ---
# Definisikan Nama-nama States (Status)
states <- c("Instagram", "WhatsApp", "Website Kampus")

# Matriks Probabilitas Transisi (P) dari perhitungan 1-langkah sebelumnya
# Masukkan nilai P yang telah Anda hitung (berdasarkan hasil eksekusi sebelumnya):
P_matrix <- matrix(
  c(0.0000, 0.5309, 0.4691,  # Baris 1: From Instagram
    0.7037, 0.0000, 0.2963,  # Baris 2: From WhatsApp
    0.6543, 0.3457, 0.0000), # Baris 3: From Website Kampus
  nrow = 3,
  byrow = TRUE, # Penting: Matriks diisi per baris
  dimnames = list(From = states, To = states)
)

# Konversi matriks P ke objek markovchain
mc <- new("markovchain", states = states, transitionMatrix = P_matrix, name = "PlatformSwitching")

# ====================================================================
# --- 3. Peluang Transisi n-Langkah (Menggunakan Pangkat Matriks) ---
# ====================================================================

# a) Peluang Transisi 2-Langkah (P^2)
# Ini adalah peluang perpindahan setelah 2 kali interaksi/transisi
P2 <- mc^2
cat("\n--- Matriks Probabilitas Transisi 2-Langkah (P^2) ---\n")
print(P2)

# b) Peluang Transisi 3-Langkah (P^3)
P3 <- mc^3
cat("\n--- Matriks Probabilitas Transisi 3-Langkah (P^3) ---\n")
print(P3)

# b) Peluang Transisi 3-Langkah (P^3)
P44 <- mc^44
cat("\n--- Matriks Probabilitas Transisi 44-Langkah (P^44) ---\n")
print(P44)

# Anda bisa menghitung P^n untuk n berapapun (misalnya P^10)

# ====================================================================
# --- 4. Steady State (Vektor Keadaan Keseimbangan / Stabil) ---
# ====================================================================

# Steady State adalah limit dari P^n ketika n menuju tak hingga (stabil)
steady_state_vector <- steadyStates(mc)

cat("\n--- Steady State Vector (Vektor Keadaan Keseimbangan Jangka Panjang) ---\n")
print(steady_state_vector)
```
